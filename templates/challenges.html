{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<section id="language-path" class="mb-12">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">
        {% if selected_language %}
            {{ selected_language }} Learning Path
        {% else %}
            All Challenges
        {% endif %}
    </h1>
    <p class="text-gray-600 mb-10">Progress through levels to unlock advanced challenges and earn rewards!</p>
    
    <div class="flex space-x-2 mb-8 border-b pb-4 overflow-x-auto">
        <a href="{{ url_for('challenges_list') }}" 
           class="flex-shrink-0 px-3 py-1 border rounded-md text-sm font-medium {% if selected_language == None %}bg-indigo-600 text-white{% else %}bg-white text-gray-700 border-gray-300 hover:bg-gray-50{% endif %}">
            All Challenges
        </a>
        {% for lang in all_languages %}
        <a href="{{ url_for('challenges_list', language_name=lang.language_name) }}" 
           class="flex-shrink-0 px-3 py-1 border rounded-md text-sm font-medium 
           {% if selected_language == lang.language_name %}bg-indigo-600 text-white{% else %}bg-white text-gray-700 border-gray-300 hover:bg-gray-50{% endif %}">
            {{ lang.language_name }}
        </a>
        {% endfor %}
    </div>

    {% if selected_language %}
        {% if levels %}
            <div class="space-y-6 max-w-4xl mx-auto">
                {% for level in levels %}
                    {% set is_reward_zone = (level.level_number == 3 or level.level_number == 6) %}
                    
                    <div class="level-card bg-white shadow-lg rounded-xl p-6 transition duration-300 hover:shadow-xl">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">{{ level.level_name }}</h3>
                                <p class="text-sm text-gray-500">XP Required for Next Level: {{ level.xp_required }}</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                
                                 
                                    <a href="{{ url_for('level_detail', level_id=level.level_id) }}" 
                                        class="px-4 py-2 {% if is_reward_zone %}bg-red-600 hover:bg-red-700{% else %}bg-indigo-600 hover:bg-indigo-700{% endif %} text-white rounded-lg text-sm font-bold transition">
                                        View Units
                                    </a>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-100">
                             <h4 class="text-sm font-semibold mb-2 text-gray-700">Units in this Level:</h4>
                            <div class="flex flex-wrap gap-3">
                                {% set units_list = [] %}
                                {% if level.level_number == 1 %}{% set units_list = ['Variables & Data Types', 'Operators & Expressions', 'Input/Output (I/O)'] %}
                                {% elif level.level_number == 2 %}{% set units_list = ['Conditional Statements', 'Looping Structures', 'Switch Statement'] %}
                                {% elif level.level_number == 3 %}{% set units_list = ['Functions (Prototyping)', 'Recursion', 'MINI-BOSS REWARD'] %}
                                {% elif level.level_number == 4 %}{% set units_list = ['Arrays (1D & Multi-dim.)', 'Strings', 'Structures & Unions'] %}
                                {% elif level.level_number == 5 %}{% set units_list = ['Pointers (Fundamentals)', 'Dynamic Memory', 'Pointers to Arrays & Strings'] %}
                                {% elif level.level_number == 6 %}{% set units_list = ['File Input/Output', 'Preprocessor Directives', 'MEGA-BOSS REWARD'] %}
                                {% endif %}
                                
                                {% for unit in units_list %}
                                    <span class="px-3 py-1 text-xs font-medium rounded-full {% if 'REWARD' in unit %}bg-yellow-100 text-yellow-800{% else %}bg-gray-100 text-gray-600{% endif %}">
                                        {{ unit }}
                                    </span>
                                {% endfor %}
                            </div>
                        </div>
                        
                    </div>

                    {% if is_reward_zone %}
                        <div class="text-center py-4 relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-dashed border-gray-300"></div>
                            </div>
                            <div class="relative inline-flex bg-white px-4">
                                <span class="text-2xl font-bold text-red-600 level-complete hover:scale-110 transition duration-500">
                                    {% if level.level_number == 3 %}
                                        ü•á MINI-BOSS REWARD ZONE!
                                    {% else %}
                                        üèÜ MEGA-BOSS REWARD ZONE!
                                    {% endif %}
                                </span>
                                <span class="ml-4 px-3 py-1 text-sm font-bold rounded-full bg-yellow-100 text-yellow-800">
                                    +{{ level.xp_required }} XP Bonus
                                </span>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-blue-50 border-2 border-blue-300 p-6 rounded-xl text-center">
                <p class="text-lg text-blue-800 font-semibold">No Levels defined for {{ selected_language }} yet. Select 'All Challenges' to view raw challenge cards.</p>
            </div>
        {% endif %}

    {% else %}
        <div class="bg-yellow-50 border-2 border-yellow-300 p-6 rounded-xl text-center">
            <p class="text-lg text-yellow-800 font-semibold">Please select a language above to view the structured learning path.</p>
        </div>

    {% endif %}
</section>
{% endblock %}